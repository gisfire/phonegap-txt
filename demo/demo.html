<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="content-language" content="zh">
    <meta name=viewport content="width=device-width, initial-scale=1">
    <title>Baidu Map on Leaflet.js</title>
    <meta name="description" content="Baidu Map on Leaflet.js : 墨卡托投影 ( Mercator Projection ) , 坐标偏移">
    <meta name="keywords" content="中国, 上海, 雾霾, 地图, 大数据, 可视化, 墨卡托投影, BigData, Map, SRS, Mercator Projection">
    <link rel="canonical" href="/map/leaflet-baidu/">

</head>
<header>
    <link  href="js/leaflet/lib/leaflet.css" rel="stylesheet" />
    <style>
        html, body {
            height: 100%;
            margin: 0;
        }

        #map {
            width: 100%;
            height: 100%;
        }
    </style>
</header>

<body>
    <div id="map"></div>
    <script src="js/leaflet/lib/leaflet-src.js"></script>
    <script src="js/leaflet/lib/leaflet-baidu.js"></script>
    <script src="js/leaflet/lib/baiduMapAPI-2.0-min.js"></script>
    <script src="js/coordtransform/coordtransform.js"></script>
    <!-- <script type="javascript">window.BMAP_AUTHENTIC_KEY = "<your key>";</script> -->
    <script>
    var options = {
      crs: L.CRS.EPSGB3857,
      center: [31.207391, 121.608203],
      zoom: 13
    };

    var Normal = new L.TileLayer.BaiduLayer("Normal.Map");
    


    var overlayMaps = {
        Office: L.marker(L.latLng(31.207391, 121.608203)).bindPopup('I\'m working Shanghai in SAP Labs!')
    };

    //options.layers = [baseMaps.Normal, overlayMaps.Office];
    var map = L.map('map', options);
    Normal.addTo(map);

    //GPS定位
    function onLocationFound(e) {
        var bd09togcj02 = coordtransform.gcj02tobd09(e.latlng.lng, e.latlng.lat);
        var radius = e.accuracy / 2;


        L.marker([bd09togcj02[1]-0.0016, bd09togcj02[0]+0.006]).addTo(map)
			.bindPopup("You are within " + radius + " meters from this point").openPopup();
        L.circle(e.latlng, radius).addTo(map);
        var bd09togcj02 = coordtransform.gcj02tobd09(116.404, 39.915);
        console.log(bd09togcj02);
    }

    function onLocationError(e) {
        alert(e.message);
    }

    map.on('locationfound', onLocationFound);
    map.on('locationerror', onLocationError);

    map.locate({ setView: true, maxZoom: 16 });

    //L.control.layers(baseMaps, overlayMaps).addTo(map);
    </script>
</body>
</html>
